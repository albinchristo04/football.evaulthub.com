---
import BaseLayout from '../layouts/BaseLayout.astro';
import MatchCard from '../components/MatchCard.astro';

const response = await fetch('https://raw.githubusercontent.com/albinchristo04/blogger-autopost/refs/heads/main/rojadirecta_events.json');
const data = await response.json();
const events = data.events || [];

const transformedMatches = events.map((event: any) => ({
  title: event.description,
  competition: event.country,
  date: event.date,
  time: event.time,
  channels: event.channels.map((ch: any) => ({
    name: ch.name,
    url: ch.decoded_url
  }))
}));

const groupedMatches = transformedMatches.reduce((acc: any, match: any) => {
  const date = match.date;
  if (!acc[date]) {
    acc[date] = [];
  }
  acc[date].push(match);
  return acc;
}, {});

const sortedDates = Object.keys(groupedMatches).sort((a, b) => {
  return new Date(a).getTime() - new Date(b).getTime();
});
---

<BaseLayout title="Inicio">
  <div class="container">
    <h2 class="section-title">PROGRAMACIÃ“N DE HOY EN VIVO</h2>
    
    <div class="match-list">
      {sortedDates.map(date => (
        <div class="date-group">
          <div class="date-header">{date}</div>
          {groupedMatches[date].map((match: any) => (
            <MatchCard match={match} />
          ))}
        </div>
      ))}
    </div>
  </div>
</BaseLayout>

<style>
  .date-header {
    background: #333;
    color: #fff;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    font-weight: bold;
    margin: 1rem 0 0.5rem 0;
    border-radius: 4px;
    text-transform: uppercase;
  }
</style>
