---
import BaseLayout from '../layouts/BaseLayout.astro';
import MatchCard from '../components/MatchCard.astro';

const response = await fetch('https://raw.githubusercontent.com/albinchristo04/blogger-autopost/refs/heads/main/rojadirecta_events.json');
const data = await response.json();
const events = data.events || [];

const transformedMatches = events.map((event: any) => ({
  title: event.description,
  competition: event.country,
  date: event.date,
  time: event.time,
  channels: event.channels.map((ch: any) => ({
    name: ch.name,
    url: ch.decoded_url
  }))
}));

const groupedMatches = transformedMatches.reduce((acc: any, match: any) => {
  const date = match.date;
  if (!acc[date]) {
    acc[date] = [];
  }
  acc[date].push(match);
  return acc;
}, {});

const sortedDates = Object.keys(groupedMatches).sort((a, b) => {
  return new Date(a).getTime() - new Date(b).getTime();
});
---

<BaseLayout title="Inicio">
  <div class="page-title-bar">
    <span>⚽</span> PROGRAMACIÓN DE HOY EN VIVO
  </div>
  
  <div class="match-list">
    {sortedDates.map(date => (
      <div class="date-group">
        <div class="date-header">{date}</div>
        {groupedMatches[date].map((match: any) => (
          <MatchCard match={match} />
        ))}
      </div>
    ))}
  </div>

  <div class="pagination-mock">
    <button class="btn btn-outline">Cargar más partidos</button>
  </div>
</BaseLayout>

<style>
  .date-header {
    background: #222;
    color: #eee;
    padding: 0.5rem 1rem;
    font-size: 0.8rem;
    font-weight: 700;
    margin: 1.5rem 0 0.5rem 0;
    border-radius: var(--radius);
    text-transform: uppercase;
  }

  .pagination-mock {
    display: flex;
    justify-content: center;
    margin-top: 2rem;
  }

  .btn-outline {
    background: transparent;
    border: 1px solid var(--primary-red);
    color: var(--primary-red);
  }

  .btn-outline:hover {
    background: var(--primary-red);
    color: white;
  }
</style>
