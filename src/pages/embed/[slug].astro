---
import { slugify } from '../../utils/slugify';

export async function getStaticPaths() {
  const paths = [];
  
  // Fetch Server 1
  const res1 = await fetch('https://raw.githubusercontent.com/albinchristo04/blogger-autopost/refs/heads/main/rojadirecta_events.json');
  const d1 = await res1.json();
  (d1.events || []).forEach((e: any) => {
    const matchSlug = slugify(`${e.country}-${e.description}`);
    e.channels.forEach((ch: any, index: number) => {
      paths.push({
        params: { slug: `${matchSlug}-ch${index + 1}` },
        props: { url: ch.decoded_url, server: 'Server 1' }
      });
    });
  });

  // Fetch Server 2
  const res2 = await fetch('https://raw.githubusercontent.com/albinchristo04/mayiru/refs/heads/main/sports_events.json');
  const d2 = await res2.json();
  Object.entries(d2.events || {}).forEach(([day, events]: [string, any]) => {
    events.forEach((e: any) => {
      const matchSlug = slugify(`Sports-${e.event}`);
      e.streams.forEach((url: string, index: number) => {
        paths.push({
          params: { slug: `${matchSlug}-ch${index + 1}` },
          props: { url: url, server: 'Server 2' }
        });
      });
    });
  });

  // Fetch Server 3
  const res3 = await fetch('https://raw.githubusercontent.com/albinchristo04/ptv/refs/heads/main/events_with_m3u8.json');
  const d3 = await res3.json();
  (d3.events?.streams || []).forEach((category: any) => {
    category.streams.forEach((e: any) => {
      const matchSlug = slugify(`${category.category}-${e.name}`);
      paths.push({
        params: { slug: `${matchSlug}-ch1` },
        props: { url: e.iframe, server: 'Server 3' }
      });
    });
  });

  return paths;
}

const { url, server } = Astro.props;
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player | football.evaulthub.com</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
    <!-- Sandbox for Server 2 to block source popups -->
    {server === 'Server 2' ? (
      <script is:inline>
        window.open = function() { return null; };
      </script>
    ) : null}
    
    <!-- Our Popup Ad -->
    <script src="https://pl26869306.effectivegatecpm.com/22/9f/cc/229fcc7fac3be2c689fa4fa174ce4169.js"></script>
</head>
<body>
    <iframe 
        src={url} 
        allowfullscreen 
        scrolling="no"
        sandbox={server === 'Server 2' ? "allow-scripts allow-same-origin allow-forms allow-presentation" : undefined}
    ></iframe>
</body>
</html>
